<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
  <title>Spinnaker C++: Streaming with Myricom Network Adapters</title>
  <link href="tabs.css" rel="stylesheet" type="text/css"/>
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="dynsections.js"></script>
  <script type="text/javascript" src="ga.js"></script>
  <link href="stylesheet.css" rel="stylesheet" type="text/css" />
</head>
<body>
  <div id="top"><!-- do not remove this div! -->
  <div id="titlearea">
    <table cellspacing="0" cellpadding="0.9em" width="100%">
      <tbody>
        <tr style="height: 56px;">
          <td id="projectlogo" style="padding-left: 0.9em;text-align: left;background: #ffffff;background: #002f86;color: #ffffff;" width="30%"><a href="https://www.flir.com/iis/machine-vision"><img alt="Logo" src="FLIR_Logo.png"/></a></td>
          <td style="padding-left: 0.5em;text-align: left;background: #002f86;background: #002f86;color: #ffffff;" width="30%"><div id="projectname">Spinnaker C++</div></td>
          <td style="padding-right: 0.9em;text-align: right;background: #002f86;background: #002f86;color: #ffffff;" width="30%"><div id="projectname"><span id="projectnumber">3.0.0.118</span></td>
        </tr>
      </tbody>
    </table>
  </div>
<!-- Generated by Doxygen 1.8.5 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="index.html">Getting Started</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Streaming with Myricom Network Adapters </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#overview">Myricom ARC Series C-Class Network Adapters</a><ul><li class="level2"><a href="#overviewlwf">Light Weight Filter Stream Mode</a></li>
<li class="level2"><a href="#overviewmva">Machine Vision Accelerator Stream Mode</a></li>
</ul>
</li>
<li class="level1"><a href="#setupmva">Setting up MVA stream mode</a></li>
<li class="level1"><a href="#performance">Power Saving / Performance Speed Options</a><ul><li class="level2"><a href="#performancepower">Power Saving / Performance</a></li>
<li class="level2"><a href="#performancehyperthread">Hyper-Threading</a></li>
</ul>
</li>
<li class="level1"><a href="#troubleshootlicense">Troubleshooting License installation</a></li>
<li class="level1"><a href="#troubleshootled">Troubleshooting Adapter LEDs</a></li>
<li class="level1"><a href="#troubleshoot_stream">Troubleshooting Streaming</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="overview"></a>
Myricom ARC Series C-Class Network Adapters</h1>
<p>FLIR <a class="el" href="namespace_spinnaker.html">Spinnaker</a> SDK offers three types of stream modes when acquiring images from a GigE camera depending on the platform you're running on and the hardware you have available. By default, <a class="el" href="namespace_spinnaker.html">Spinnaker</a> will stream with the Light Weight Filter driver (LWF) stream mode on Windows and Socket stream mode on Linux and MacOS. If a Myricom ARC Series Adapter is installed and discovered on the Windows system, <a class="el" href="namespace_spinnaker.html">Spinnaker</a> will automatically default to the Machine Vision Accelerator (MVA) stream mode.</p>
<h2><a class="anchor" id="overviewlwf"></a>
Light Weight Filter Stream Mode</h2>
<p>In this streaming mode, images are filtered and processed through light weight filter driver. On Windows, this mode utilizes the NDIS kernel driver architecture to accelerate performance with a single copy from the network stack to the user memory buffer. You will need to make sure FLIR's filter driver (PGRLWF) is installed, which comes installed with the <a class="el" href="namespace_spinnaker.html">Spinnaker</a> Windows Installer.</p>
<p>For more information on how to setup an FLIR Oryx 10GigE Camera and the associated filter driver, please refer to: <a href="https://www.flir.ca/support-center/iis/machine-vision/application-note/getting-started-with-the-flir-oryx-10gige-camera/">https://www.flir.ca/support-center/iis/machine-vision/application-note/getting-started-with-the-flir-oryx-10gige-camera/</a></p>
<h2><a class="anchor" id="overviewmva"></a>
Machine Vision Accelerator Stream Mode</h2>
<p>This stream mode requires a compatible Myricom ARC Series network adapter to be installed and is enabled by Myricom's MVA software and driver to help improve the performance of machine vision applications for processing data from GigE vision devices. This streaming mode reduces the host processor overhead while providing maximum throughput when receiving GigE Vision Stream Protocol (GVSP) content.</p>
<p>You will need to make sure <a class="el" href="namespace_spinnaker.html">Spinnaker</a> 2.5 SDK or later is installed along with Myricom's MVA 2.x driver, which comes installed with the <a class="el" href="namespace_spinnaker.html">Spinnaker</a> Windows Installer. You can also manually download and install the full MVA Software, utilities, and driver from <a href="https://www.ariacybersecurity.com/support/downloads/">https://www.ariacybersecurity.com/support/downloads/</a>.</p>
<p><b>NOTE</b>: MVA stream mode is only supported in <a class="el" href="namespace_spinnaker.html">Spinnaker</a> SDK starting with <a class="el" href="namespace_spinnaker.html">Spinnaker</a> 2.5. GigE cameras will only enumerate on the Myricom adapter when MVA 2.x driver is installed. Users have the option to stream with either the LWF or MVA stream mode when the GigE camera is connected to a Myricom network adapter, but we recommend using MVA stream mode for best performance.</p>
<h1><a class="anchor" id="setupmva"></a>
Setting up MVA stream mode</h1>
<p>There is no specific setup required to acquire images using the MVA stream mode. <a class="el" href="namespace_spinnaker.html">Spinnaker</a> will default to MVA stream mode when a compatible Myricom ARC Series network adapter is detected. A GenICam GenTL Transport Layer DataStream node is available for GigE data streams if developers would like to manually switch between the stream modes.</p>
<p>Sample C++ code snippet demonstrating switching between the stream modes with <a class="el" href="namespace_spinnaker.html">Spinnaker</a> GenICam GenAPI: </p>
<pre class="fragment">CEnumerationPtr streamMode = camera-&gt;GetTLStreamNodeMap().GetNode("StreamMode");

# Select LWF Stream Mode
streamMode-&gt;SetIntValue(streamMode-&gt;GetEntryByName("LWF")-&gt;GetValue());

# Select MVA Stream Mode
streamMode-&gt;SetIntValue(streamMode-&gt;GetEntryByName("MVA")-&gt;GetValue());
</pre><p>Sample C++ code snippet demonstrating switching between the stream modes with <a class="el" href="namespace_spinnaker.html">Spinnaker</a> QuickSpin GenAPI: </p>
<pre class="fragment"># Select LWF Stream Mode
camera-&gt;TLStream.StreamMode.SetValue(StreamMode_LWF);

# Select MVA Stream Mode
camera-&gt;TLStream.StreamMode.SetValue(StreamMode_MVA);
</pre><p>To switch between the stream modes in SpinView_WPF, simply navigate to the features tab and expand "Stream Parameters" and "Stream Information" and then click on the drop-down menu for "StreamMode" to select the available modes on your system.</p>
<div class="image">
<img src="StreamMode.png" alt="StreamMode.png"/>
</div>
<h1><a class="anchor" id="performance"></a>
Power Saving / Performance Speed Options</h1>
<p>For best performance, disabling power saving modes and hyper-threading in the host BIOS is recommended.</p>
<h2><a class="anchor" id="performancepower"></a>
Power Saving / Performance</h2>
<p>To help mitigate temperature issues, many servers employ power saving techniques, such as Active State Power Management (ASPM), or options for decreasing clock speeds. Both of these options can significantly impact performance. It is recommended to disable all power saving options or configure the server to optimize performance in the BIOS.</p>
<p>This includes disabling the following:</p>
<ul>
<li>ASPM</li>
<li>Node Interleaving</li>
<li>Bandwidth sharing settings between device slots (see below)</li>
</ul>
<p>In addition, make sure the following are enabled:</p>
<ul>
<li>Channel Interleaving</li>
<li>Intel I/O Acceleration Technology (IOAT)</li>
</ul>
<p>Data Direct I/O Technology (DDIO) is part of the IOAT features package. When enabled, DDIO forces the adapter to send packets directly to L3 cache, which, as previously indicated, improves performance as the CPU can read data from this location faster than from RAM.</p>
<p>Some motherboards default to sharing bandwidth between less-frequently-used device slots of the motherboard. For example, the Z170-PRO motherboard defaults to a reduce bandwidth on PCIEx16_3 in order to operate SATA5 and 6 slots. This causes performance issues for the MVA card and may cause dropped packets. If you are installing the MVA card onto this slot, or in general, slots furthest away from the motherboard, ensure Advanced-&gt;Onboard Devices Configuration-&gt;PCI-EX16_3 Bandwidth is set to [x4 Mode] instead of the default [Auto].</p>
<h2><a class="anchor" id="performancehyperthread"></a>
Hyper-Threading</h2>
<p>When hyper-threading is enabled, the operating system detects two logical cores per processor core, which allows the concurrent scheduling of two processes. However, the logical cores share the resources of the CPU. Both logical cores will compete for L1 and L2 cache access, but all cores of the CPU must share the pool of L3 cache. This can lead to poor cache utilization, or cache thrashing, depending on the amount of context needed to maintain packet information during processing. It is recommended to disable hyper-threading in the BIOS to avoid resource contention between the cores for best performance.</p>
<h1><a class="anchor" id="troubleshootlicense"></a>
Troubleshooting License installation</h1>
<p>Myricom network adapters purchased directly from FLIR will already have proper perpetual licenses installed, so users will not need to worry about setting it up. Cards purchased from third party vendors will require users to acquire proper license from Myricom directly.</p>
<p>To check the license information on your installed Myricom cards, you will need to run "myri_license.exe" utility that is packaged with <a class="el" href="namespace_spinnaker.html">Spinnaker</a> SDK installer in an elevated permission prompt.</p>
<p>Once you have acquired a valid license from Myricom, you will be able to install the license by copying and pasting the license string in an empty text file, and running the "myri_license.exe" as follows: </p>
<pre class="fragment">myri_license.exe -f license
</pre><p><b>NOTE</b>: You will be able to enumerate a GigE camera on the Myricom adapter as long as you have the MVA driver installed. You will however get an error during <a class="el" href="group___spinnaker_direct_show__h.html#gaeec98de2341e0a7c1803cc713cf1e051" title="Starts the image acquisition engine for the currently selected camera. ">BeginAcquisition()</a> if you don't have a valid MVA-enabled network adapter with a valid license installed.</p>
<h1><a class="anchor" id="troubleshootled"></a>
Troubleshooting Adapter LEDs</h1>
<p>Myricom network adapters have two indicating LEDs per port: one green and one amber. These LEDs light to indicate the status of the adapter and network traffic. Please refer to the following table for a description of the different color and states.</p>
<table class="doxtable">
<tr>
<th align="left">Color </th><th align="left">State </th><th align="left">Indicates  </th></tr>
<tr>
<td align="left">Amber </td><td align="left">Blinking Twice Per Second </td><td align="left">The adapter is powered on and the LANAI firmware is functioning. </td></tr>
<tr>
<td align="left">^ </td><td align="left">Off </td><td align="left">The adapter has not established a PCIe link or the operating system has not booted yet. </td></tr>
<tr>
<td align="left">^ </td><td align="left">Solidly Lit </td><td align="left">The EEPROM is corrupted. Contact Support for assistance. </td></tr>
<tr>
<td align="left">^ </td><td align="left">Blinking Rapidly </td><td align="left">There is an issue with EEPROM. Contact Support for assistance. </td></tr>
<tr>
<td align="left">^ </td><td align="left">Blink Rapidly Five Times, Followed By a Pause </td><td align="left">The adapter failed to establish a PCIe link. Contact Support for assistance. </td></tr>
<tr>
<td align="left">Green </td><td align="left">Solidly Lit </td><td align="left">The adapter is powered on and has established a link. </td></tr>
<tr>
<td align="left">^ </td><td align="left">Off </td><td align="left">The adapter has not established a link or operating system has not booted yet. </td></tr>
<tr>
<td align="left">^ </td><td align="left">Blinking </td><td align="left">There is active traffic on the port. </td></tr>
</table>
<h1><a class="anchor" id="troubleshoot_stream"></a>
Troubleshooting Streaming</h1>
<p>When the network performance is below expectation, please follow these steps to isolate the problem:</p>
<ol type="1">
<li>Refer to <a class="el" href="_myricom.html#performancepower">Power Saving / Performance</a> section to learn about benefits of disabling power saving and hyper-threading in the BIOS for improving performance.</li>
<li>Verify the MVA network adapter is installed into an x8 PCIe slot on the motherboard</li>
<li>Refer to <a class="el" href="_myricom.html#troubleshootlicense">Troubleshooting License installation</a> section to verify the status of the license</li>
<li>Enable verbose and debug environment variables prior to execution to obtain diagnostic information from the MVA library.</li>
</ol>
<p>To debug streaming issues with MVA stream mode, MVA API supports two environment variables that assist with troubleshooting. The variables are as follows:</p>
<ul>
<li>MVA_VERBOSE - Enables verbose mode for logging purposes.</li>
<li>MVA_DEBUG - Enables debug mode, which provides more information than verbose mode, for logging purposes.</li>
</ul>
<p>To set environment variables in Windows, use either an elevated permission command prompt or PowerShell. </p>
<pre class="fragment"># For PowerShell
Set-Content env:MVA_DEBUG 1
Set-Content env:MVA_VERBOSE 1

# Command Prompt
SET MVA_DEBUG=1
SET MVA_VERBOSE=1</pre> </div></div><!-- contents -->

  <table style="width: 100%;border-spacing: 0px 0px;border-left-style: solid;border-left-width: ;border-left-color: #8c8888;border-right-style: solid;border-right-width: ;border-right-color: #8c8888;border-top-style: solid;border-top-width: ;border-top-color: #8c8888;border-bottom-style: solid;border-bottom-width: ;border-bottom-color: #8c8888;margin-left: 0;margin-right: auto;padding: 0px">
    <col />
    <col />
    <col />
        <tbody>
            <tr>
                <td style="background-color: #8c8888;color: #ffffff;"><a class="footer" href="https://www.flir.com/support-center/rma/iis-support-request">Contact Support </a> </td>
                <td style="background-color: #8c8888;color: #ffffff;text-align: center;font-size: 16px;font-weight: bold">Spinnaker&#174; SDK Programmer's Guide and API Reference</td>
                <td style="background-color: #8c8888;color: #ffffff;text-align: right;"><address class="footer">
Fri Dec 16 2022 &#160;Â© <a class="footer" href="https://www.flir.com/iis/machine-vision">FLIR Integrated Imaging Solutions Inc. All rights reserved.</a></address></td>
            </tr>
        </tbody>
  </table>
</body>
</html>
